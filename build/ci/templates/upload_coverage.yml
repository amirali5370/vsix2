steps:
    # Generate the coverage reports.
    - bash: |
        npm run test:cover:report
      displayName: 'run test:cover:report'
      condition: contains(variables['TestsToRun'], 'testUnitTests')
      failOnStderr: false


    # Publish Code Coverage Results
    - task: PublishCodeCoverageResults@1
      displayName: 'Publish test:unittests coverage results'
      condition: contains(variables['TestsToRun'], 'testUnitTests')
      inputs:
        codeCoverageTool: 'cobertura'
        summaryFileLocation: "$(System.DefaultWorkingDirectory)/coverage/cobertura-coverage.xml"
        reportDirectory: "$(System.DefaultWorkingDirectory)/coverage"

    # - task: CopyFiles@2
    #   inputs:
    #       sourceFolder: "$(Build.SourcesDirectory)/VSIX"
    #       targetFolder: $(Build.SourcesDirectory)
    #   displayName: "Copy VSIX"
    #   condition: succeeded()

    # Now that we have downloaded artificats from `coverage-output-`, copy them
    # into the root directory (they'll go under `.nyc_output/...`)
    # These are the coverage output files that can be merged and then we can generate a report from them.
    - bash: |
        echo "List folders0"
        cp -r coverage-output-*/ ./
        ls
        echo "List folders"
        ls -dlU .*/ */
        echo "List folders2"
        pwd
        echo "List folders3"
        cd ./.nyc_output
        ls
        ls -dlU .*/ */
      displayName: "List nyc_output"
      condition: always()

    - bash: |
        echo "Publish Coverage"
        ls
        echo "List folders"
        ls -dlU .*/ */
      workingDirectory: $(Build.SourcesDirectory)
      displayName: "List nyc_output"
      condition: always()
