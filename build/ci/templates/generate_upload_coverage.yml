steps:
    # Generate the coverage reports.
    - bash: |
        npm run test:cover:report
      displayName: 'run test:cover:report'
      condition: contains(variables['TestsToRun'], 'testUnitTests')
      failOnStderr: false


    # Publish Code Coverage Results
    - task: PublishCodeCoverageResults@1
      displayName: 'Publish test:unittests coverage results'
      condition: contains(variables['TestsToRun'], 'testUnitTests')
      inputs:
        codeCoverageTool: 'cobertura'
        summaryFileLocation: "$(System.DefaultWorkingDirectory)/coverage/cobertura-coverage.xml"
        reportDirectory: "$(System.DefaultWorkingDirectory)/coverage"

    - script: |
        echo $BUILD_BUILDID
        export COVERALLS_SERVICE_JOB_ID=$BUILD_BUILDID
        echo $COVERALLS_SERVICE_JOB_ID
      condition: contains(variables['TestsToRun'], 'testUnitTests')
  
    # Upload to coveralls
    - bash: |
        echo "COVERALLS_SERVICE_JOB_ID"
        echo $COVERALLS_SERVICE_JOB_ID
        echo $COVERALLS_SERVICE_JOB_ID
        echo "Publish Coverage"
        ls
        cd coverage
        ls
      displayName: "Publish Coverage to Coveralls"
      condition: contains(variables['TestsToRun'], 'testUnitTests')
