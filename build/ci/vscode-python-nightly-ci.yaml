resources:
- repo: self
  clean: true

# No trigger specified here. This is a nightly build only and
# there isn't a way to specify scheduled builds in YAML at time
# of writing...
trigger: none

# Only nightly builds.
pr: none

jobs:

# Build the extension and run unit tests on it, if successful upload
# the bits to be used in each subsequent job
- template: templates/compile-and-validate.yml
  parameters:
    name: 'Prebuild'
    pool:
      name: 'Hosted VS2017'
    UploadBinary: true
    Platform: 'Windows'
    PythonVersion: '3.7'

# Begin test phases:
- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool: 
      name: 'Hosted VS2017'
    Platform: 'Windows'
    PythonVersion: '3.7'
    Name: 'SystemTests_Windows_Py37'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool: 
      name: 'Hosted VS2017'
    Platform: 'Windows'
    PythonVersion: '3.6'
    Name: 'SystemTests_Windows_Py36'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool: 
      name: 'Hosted VS2017'
    Platform: 'Windows'
    PythonVersion: '3.5'
    Name: 'SystemTests_Windows_Py35'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool: 
      name: 'Hosted VS2017'
    Platform: 'Windows'
    PythonVersion: '3.4'
    Name: 'SystemTests_Windows_Py34'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool: 
      name: 'Hosted VS2017'
    Platform: 'Windows'
    PythonVersion: '2.7'
    Name: 'SystemTests_Windows_Py27'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted Ubuntu 1604'
    Platform: 'Linux'
    PythonVersion: '3.7'
    Name: 'SystemTests_Linux_Py37'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted Ubuntu 1604'
    Platform: 'Linux'
    PythonVersion: '3.6'
    Name: 'SystemTests_Linux_Py36'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted Ubuntu 1604'
    Platform: 'Linux'
    PythonVersion: '3.5'
    Name: 'SystemTests_Linux_Py35'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted Ubuntu 1604'
    Platform: 'Linux'
    PythonVersion: '3.4'
    Name: 'SystemTests_Linux_Py34'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted Ubuntu 1604'
    Platform: 'Linux'
    PythonVersion: '2.7'
    Name: 'SystemTests_Linux_Py27'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted macOS'
    Platform: 'macOS'
    PythonVersion: '3.7'
    Name: 'SystemTests_macOS_Py37'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted macOS'
    Platform: 'macOS'
    PythonVersion: '3.6'
    Name: 'SystemTests_macOS_Py36'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted macOS'
    Platform: 'macOS'
    PythonVersion: '3.5'
    Name: 'SystemTests_macOS_Py35'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted macOS'
    Platform: 'macOS'
    PythonVersion: '3.4'
    Name: 'SystemTests_macOS_Py34'

- template: templates/test-phase-job.yml
  parameters:
    DependsOn: 'Prebuild'
    pool:
      name: 'Hosted macOS'
    Platform: 'macOS'
    PythonVersion: '2.7'
    Name: 'SystemTests_macOS_Py27'

