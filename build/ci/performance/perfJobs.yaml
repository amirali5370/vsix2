jobs:
- job: Testing_Round_1
  timeoutInMinutes: 120
  strategy:
    matrix:
      'Win-Py3.7':
        PythonVersion: '3.7'
        VMImageName: 'vs2017-win2016'
        PYTHON_VIRTUAL_ENVS_LOCATION: './src/tmp/envPaths.json'
  pool: DSPerf
  steps:
    - pwsh: |
        npm install
        npm install -g mocha
        npm install -g source-map-support
        npm install -g mocha-multi-reporters
        tsc -p ./
        mocha --require source-map-support/register --opts ./build/.mocha.performance.opts
        node ./build/ci/performance/savePerformanceResults.js

- job: Testing_Round_2
  dependsOn:
  - Testing_Round_1
  timeoutInMinutes: 120
  strategy:
    matrix:
      'Win-Py3.7':
        PythonVersion: '3.7'
        VMImageName: 'vs2017-win2016'
  pool: DSPerf
  steps:
    - pwsh: |
        mocha --require source-map-support/register --opts ./build/.mocha.performance.opts
        node ./build/ci/performance/savePerformanceResults.js

- job: Testing_Round_3
  dependsOn:
  - Testing_Round_2
  timeoutInMinutes: 120
  strategy:
    matrix:
      'Win-Py3.7':
        PythonVersion: '3.7'
        VMImageName: 'vs2017-win2016'
  pool: DSPerf
  steps:
    - pwsh: |
        mocha --require source-map-support/register --opts ./build/.mocha.performance.opts
        node ./build/ci/performance/savePerformanceResults.js

- job: Testing_Round_4
  dependsOn:
  - Testing_Round_3
  timeoutInMinutes: 120
  strategy:
    matrix:
      'Win-Py3.7':
        PythonVersion: '3.7'
        VMImageName: 'vs2017-win2016'
  pool: DSPerf
  steps:
    - pwsh: |
        mocha --require source-map-support/register --opts ./build/.mocha.performance.opts
        node ./build/ci/performance/savePerformanceResults.js

- job: Testing_Round_5
  dependsOn:
  - Testing_Round_4
  timeoutInMinutes: 120
  strategy:
    matrix:
      'Win-Py3.7':
        PythonVersion: '3.7'
        VMImageName: 'vs2017-win2016'
  pool: DSPerf
  steps:
    - pwsh: |
        mocha --require source-map-support/register --opts ./build/.mocha.performance.opts
        node ./build/ci/performance/savePerformanceResults.js
