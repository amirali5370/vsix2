language: python
cache: pip

matrix:
    include:
        - os: linux
          python: "2.7"
          env: SINGLE_WORKSPACE_TEST=true
before_install: |
  if [ $TRAVIS_OS_NAME == "linux" ]; then
    export CXX="g++-4.9" CC="gcc-4.9" DISPLAY=:99.0;
    sh -e /etc/init.d/xvfb start;
    sleep 3;
  fi
  git clone https://github.com/creationix/nvm.git ./.nvm
  source ./.nvm/nvm.sh
  nvm install 8.9.1
  nvm use 8.9.1
  npm install npm@latest -g
  npm install -g vsce
  npm install -g azure-cli
  node --version
  npm --version
  export CI_PYTHON_PATH=`which python`
install:
  - npm ci

script:
  - if [ $SINGLE_WORKSPACE_TEST == "true" ]; then
        npm run clean;
        npm run vscode:prepublish;
        npm run cover:enable;
        npm run testSingleWorkspace --silent;
    fi
